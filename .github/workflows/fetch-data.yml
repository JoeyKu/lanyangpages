# .github/workflows/fetch-data.yml

name: 'å®šæœŸæŠ“å–è³‡æ–™ä¸¦å­˜ç‚º JS'

on:
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'

jobs:
  fetch-and-save:
    # æŒ‡å®šåŸ·è¡Œçš„è™›æ“¬ç’°å¢ƒ
    runs-on: ubuntu-latest

    # --- æ–°å¢é€™ä¸€æ®µæ¬Šé™è¨­å®š ---
    # æˆäºˆå·¥ä½œæµç¨‹å°å€‰åº«å…§å®¹çš„å¯«å…¥æ¬Šé™
    permissions:
      contents: write
    # --------------------------

    steps:
      # æ­¥é©Ÿ 1: Checkout å€‰åº«
      - name: Checkout repository
        uses: actions/checkout@v4

      # æ­¥é©Ÿ 2: æŠ“å–è³‡æ–™ä¸¦å»ºç«‹æª”æ¡ˆ
      - name: Fetch data and create JS file
        run: |
          echo "var frontDestData = " > data.js
          curl -sL 'http://xxx.xxx.xxx/api/data' >> data.js # è¨˜å¾—æ›æˆä½ çš„ç¶²å€
          echo ";" >> data.js
          echo "data.js æª”æ¡ˆå·²æˆåŠŸå»ºç«‹ã€‚"

      # æ­¥é©Ÿ 3: æäº¤ä¸¦æ¨é€
      - name: Commit and push if changed
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions-bot@github.com"
          git add data.js
          if git diff --staged --quiet; then
            echo "è³‡æ–™æ²’æœ‰è®Šå‹•ï¼Œç„¡éœ€æäº¤ã€‚"
          else
            git commit -m "ğŸ“Š è‡ªå‹•æ›´æ–°å¤–éƒ¨è³‡æ–™ - $(date -u)"
            git push
          fi
